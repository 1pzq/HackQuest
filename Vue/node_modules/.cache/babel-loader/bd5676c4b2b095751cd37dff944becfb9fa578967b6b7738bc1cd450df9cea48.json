{"ast":null,"code":"import _regeneratorRuntime from \"/Users/puzhiqiu/\\u5DE5\\u7A0B\\u9879\\u76EE/HackQuest/HackQuest/vue/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/puzhiqiu/\\u5DE5\\u7A0B\\u9879\\u76EE/HackQuest/HackQuest/vue/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.object.define-property.js\";\nimport useWeb3 from \"@/hooks/useWeb3\";\nimport { ref, onMounted } from \"vue\";\nexport default {\n  __name: 'BoardView',\n  setup: function setup(__props, _ref) {\n    var expose = _ref.expose;\n    expose();\n    var _useWeb = useWeb3(),\n      web3 = _useWeb.web3,\n      voteContract = _useWeb.voteContract,\n      getAccount = _useWeb.getAccount;\n\n    // 看板信息\n    var board = ref([]);\n    // 添加选举人\n    var addElected = ref([]);\n    // 去除选举人\n    var removeElected = ref([]);\n    // 查看最后的Winner\n    var Winner = ref([]);\n    var account = ref(\"\");\n    var getBoardInfo = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return getAccount();\n            case 2:\n              account.value = _context.sent;\n              _context.next = 5;\n              return voteContract.methods.getBoardInfo().call();\n            case 5:\n              board.value = _context.sent;\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function getBoardInfo() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    //添加选举人\n    var addTheElected = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var arr, account;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              arr = eval(addElected.value);\n              _context2.next = 3;\n              return getAccount();\n            case 3:\n              account = _context2.sent;\n              voteContract.methods.addTheElected(arr).send({\n                from: account\n              }).on(\"receipt\", function () {\n                console.log(\"添加选举人成功\");\n              });\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }));\n      return function addTheElected() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n    //去除选举人\n    var removeTheElected = /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var arr, account;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              arr = eval(removeElected.value);\n              _context3.next = 3;\n              return getAccount();\n            case 3:\n              account = _context3.sent;\n              voteContract.methods.removeElected(arr).send({\n                from: account\n              }).on(\"receipt\", function () {\n                console.log(\"去除选举人成功\");\n              });\n            case 5:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3);\n      }));\n      return function removeTheElected() {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n    //获取最后的决胜者\n    var getTheWinner = /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return voteContract.methods.getWinInfo().call();\n            case 2:\n              Winner.value = _context4.sent;\n            case 3:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4);\n      }));\n      return function getTheWinner() {\n        return _ref5.apply(this, arguments);\n      };\n    }();\n\n    //进行投票\n    var vote = /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(index) {\n        var account, result;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return getAccount();\n            case 2:\n              account = _context5.sent;\n              _context5.next = 5;\n              return voteContract.methods.vote(index).send({\n                from: account\n              });\n            case 5:\n              result = _context5.sent;\n            case 6:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5);\n      }));\n      return function vote(_x) {\n        return _ref6.apply(this, arguments);\n      };\n    }();\n    var initEventListen = function initEventListen() {\n      voteContract.events.voteSuccess({\n        fromBlock: 0\n      }, function (err, event) {\n        console.log(\"监听执行\");\n        console.log(event);\n      }).on(\"data\", function (event) {\n        console.log(\"智能合约触发的事件：\", event.returnValues);\n      });\n    };\n    onMounted(function () {\n      initEventListen();\n      getBoardInfo();\n    });\n    var __returned__ = {\n      web3: web3,\n      voteContract: voteContract,\n      getAccount: getAccount,\n      board: board,\n      addElected: addElected,\n      removeElected: removeElected,\n      Winner: Winner,\n      account: account,\n      getBoardInfo: getBoardInfo,\n      addTheElected: addTheElected,\n      removeTheElected: removeTheElected,\n      getTheWinner: getTheWinner,\n      vote: vote,\n      initEventListen: initEventListen,\n      get useWeb3() {\n        return useWeb3;\n      },\n      ref: ref,\n      onMounted: onMounted\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"mappings":"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","names":["useWeb3","ref","onMounted","web3","voteContract","getAccount","board","addElected","removeElected","Winner","account","getBoardInfo","value","methods","call","addTheElected","arr","eval","send","from","on","console","log","removeTheElected","getTheWinner","getWinInfo","vote","index","result","initEventListen","events","voteSuccess","fromBlock","err","event","returnValues"],"sources":["/Users/puzhiqiu/工程项目/HackQuest/HackQuest/vue/src/views/BoardView.vue"],"sourcesContent":["<!-- <script setup>\nimport useWeb3 from \"@/hooks/useWeb3\";\nimport { ref, onMounted } from \"vue\";\nconst { web3, voteContract, getAccount } = useWeb3();\n\n// 看板信息\nconst board = ref([]);\n// 添加选举人\nconst addElected = ref([]);\n// 去除选举人\nconst removeElected = ref([]);\n// 查看最后的Winner\nconst Winner = ref([]);\n\nconst account = ref(\"\");\n\nconst getBoardInfo = async () => {\n  account.value = await getAccount();\n  board.value = await voteContract.methods.getBoardInfo().call();\n};\n\n//添加选举人\nconst addTheElected = async () => {\n  const arr = eval(addElected.value);\n  const account = await getAccount();\n  voteContract.methods\n    .addTheElected(arr)\n    .send({ from: account })\n    .on(\"receipt\", () => {\n      console.log(\"添加选举人成功\");\n    });\n};\n//去除选举人\nconst removeTheElected = async () => {\n  const arr = eval(removeElected.value);\n  const account = await getAccount();\n  voteContract.methods\n    .removeElected(arr)\n    .send({ from: account })\n    .on(\"receipt\", () => {\n      console.log(\"去除选举人成功\");\n    });\n};\n//获取最后的决胜者\nconst getTheWinner = async () => {\n  Winner.value = await voteContract.methods.getWinInfo().call();\n};\n\n//进行投票\nconst vote = async (index) => {\n  const account = await getAccount();\n  const result = await voteContract.methods.vote(index).send({ from: account });\n};\n\nconst initEventListen = () => {\n  voteContract.events\n    .voteSuccess({ fromBlock: 0 }, (err, event) => {\n      console.log(\"监听执行\");\n      console.log(event);\n    })\n    .on(\"data\", (event) => {\n      console.log(\"智能合约触发的事件：\", event.returnValues);\n    });\n};\n\nonMounted(() => {\n  initEventListen();\n  getBoardInfo();\n});\n</script>\n\n<template>\n  <div class=\"box2\">\n    <van-divider\n      :style=\"{ color: '#1989fa', borderColor: 'red', padding: '-20px 10px' }\"\n    >\n      Voting board\n    </van-divider>\n\n    <van-cell\n      :title=\"item.name\"\n      icon=\"shop-o\"\n      v-for=\"(item, index) in board\"\n      :key=\"index\"\n    >\n      <template #right-icon>\n        <van-button @click=\"vote(index)\">{{ item.totalAmount }}</van-button>\n      </template>\n    </van-cell>\n  </div>\n  <div>\n    <van-cell-group inset>\n      <van-field\n        v-model=\"addElected\"\n        required\n        label=\"添加选举人\"\n        placeholder=\"请输入选举人地址\"\n      />\n    </van-cell-group>\n  </div>\n  <div class=\"btn\">\n    <van-button round block @click=\"addTheElected\" type=\"success\"\n      >添加选举人</van-button\n    >\n  </div>\n  <van-divider\n    :style=\"{ color: '#1989fa', borderColor: 'red', padding: '0px 10px' }\"\n  >\n  </van-divider>\n  <div>\n    <van-cell-group inset>\n      <van-field\n        v-model=\"removeElected\"\n        required\n        label=\"去除选举人\"\n        placeholder=\"请输入去除的选举人\"\n      />\n    </van-cell-group>\n  </div>\n\n  <div class=\"btn\">\n    <van-button round block @click=\"removeTheElected\" type=\"success\"\n      >去除选举人</van-button\n    >\n  </div>\n  <van-divider\n    :style=\"{ color: '#1989fa', borderColor: 'red', padding: '0px 10px' }\"\n  >\n  </van-divider>\n  <div>\n    <van-cell title=\"最后的胜者\" :value=\"Winner\"></van-cell>\n  </div>\n  <div>\n    <van-button round block @click=\"getTheWinner\" type=\"success\"\n      >查看最后的Winner</van-button\n    >\n  </div>\n</template>\n\n<style lang=\"less\"></style> -->\n<script setup>\nimport useWeb3 from \"@/hooks/useWeb3\";\nimport { ref, onMounted } from \"vue\";\nconst { web3, voteContract, getAccount } = useWeb3();\n\n// 看板信息\nconst board = ref([]);\n// 添加选举人\nconst addElected = ref([]);\n// 去除选举人\nconst removeElected = ref([]);\n// 查看最后的Winner\nconst Winner = ref([]);\n\nconst account = ref(\"\");\n\nconst getBoardInfo = async () => {\n  account.value = await getAccount();\n  board.value = await voteContract.methods.getBoardInfo().call();\n};\n\n//添加选举人\nconst addTheElected = async () => {\n  const arr = eval(addElected.value);\n  const account = await getAccount();\n  voteContract.methods\n    .addTheElected(arr)\n    .send({ from: account })\n    .on(\"receipt\", () => {\n      console.log(\"添加选举人成功\");\n    });\n};\n//去除选举人\nconst removeTheElected = async () => {\n  const arr = eval(removeElected.value);\n  const account = await getAccount();\n  voteContract.methods\n    .removeElected(arr)\n    .send({ from: account })\n    .on(\"receipt\", () => {\n      console.log(\"去除选举人成功\");\n    });\n};\n//获取最后的决胜者\nconst getTheWinner = async () => {\n  Winner.value = await voteContract.methods.getWinInfo().call();\n};\n\n//进行投票\nconst vote = async (index) => {\n  const account = await getAccount();\n  const result = await voteContract.methods.vote(index).send({ from: account });\n};\n\nconst initEventListen = () => {\n  voteContract.events\n    .voteSuccess({ fromBlock: 0 }, (err, event) => {\n      console.log(\"监听执行\");\n      console.log(event);\n    })\n    .on(\"data\", (event) => {\n      console.log(\"智能合约触发的事件：\", event.returnValues);\n    });\n};\n\nonMounted(() => {\n  initEventListen();\n  getBoardInfo();\n});\n</script>\n\n<template>\n  <div class=\"scrollable-box box2\">\n    <van-divider\n      :style=\"{ color: '#1989fa', borderColor: 'red', padding: '-20px 10px' }\"\n    >\n      Voting board\n    </van-divider>\n\n    <van-cell\n      :title=\"item.name\"\n      icon=\"shop-o\"\n      v-for=\"(item, index) in board\"\n      :key=\"index\"\n    >\n      <template #right-icon>\n        <van-button @click=\"vote(index)\">{{ item.totalAmount }}</van-button>\n      </template>\n    </van-cell>\n  </div>\n  <div>\n    <van-cell-group inset>\n      <van-field\n        v-model=\"addElected\"\n        required\n        label=\"添加选举人\"\n        placeholder=\"请输入选举人地址\"\n      />\n    </van-cell-group>\n  </div>\n  <div class=\"btn\">\n    <van-button round block @click=\"addTheElected\" type=\"success\"\n      >添加选举人</van-button\n    >\n  </div>\n  <van-divider\n    :style=\"{ color: '#1989fa', borderColor: 'red', padding: '0px 10px' }\"\n  >\n  </van-divider>\n  <div>\n    <van-cell-group inset>\n      <van-field\n        v-model=\"removeElected\"\n        required\n        label=\"去除选举人\"\n        placeholder=\"请输入去除的选举人\"\n      />\n    </van-cell-group>\n  </div>\n\n  <div class=\"btn\">\n    <van-button round block @click=\"removeTheElected\" type=\"success\"\n      >去除选举人</van-button\n    >\n  </div>\n  <van-divider\n    :style=\"{ color: '#1989fa', borderColor: 'red', padding: '0px 10px' }\"\n  >\n  </van-divider>\n  <div>\n    <van-cell title=\"最后的胜者\" :value=\"Winner\"></van-cell>\n  </div>\n  <div>\n    <van-button round block @click=\"getTheWinner\" type=\"success\"\n      >查看最后的Winner</van-button\n    >\n  </div>\n</template>\n\n<style scoped>\n.scrollable-box {\n  max-height: 200px; /* 固定高度，适当调整 */\n  overflow-y: auto; /* 超出区域时滚动查看 */\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}