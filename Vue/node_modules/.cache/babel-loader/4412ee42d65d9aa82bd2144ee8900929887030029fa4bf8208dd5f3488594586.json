{"ast":null,"code":"import { createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nvar _withScopeId = function _withScopeId(n) {\n  return _pushScopeId(\"data-v-49ebac03\"), n = n(), _popScopeId(), n;\n};\nvar _hoisted_1 = {\n  \"class\": \"box1\"\n};\nvar _hoisted_2 = {\n  \"class\": \"label\"\n};\nvar _hoisted_3 = {\n  \"class\": \"address\"\n};\nvar _hoisted_4 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"p\", null, \"剩余投票时间:\", -1 /* HOISTED */);\n});\nvar _hoisted_5 = {\n  \"class\": \"btn\"\n};\nvar _hoisted_6 = {\n  \"class\": \"btn\"\n};\nvar _hoisted_7 = {\n  \"class\": \"btn\"\n};\nvar _hoisted_8 = {\n  \"class\": \"btn\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_van_divider = _resolveComponent(\"van-divider\");\n  var _component_van_icon = _resolveComponent(\"van-icon\");\n  var _component_van_tag = _resolveComponent(\"van-tag\");\n  var _component_van_col = _resolveComponent(\"van-col\");\n  var _component_van_count_down = _resolveComponent(\"van-count-down\");\n  var _component_van_row = _resolveComponent(\"van-row\");\n  var _component_van_field = _resolveComponent(\"van-field\");\n  var _component_van_cell_group = _resolveComponent(\"van-cell-group\");\n  var _component_van_button = _resolveComponent(\"van-button\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_van_divider, {\n    style: {\n      color: '#1989fa',\n      borderColor: 'red',\n      padding: '-20px 10px'\n    }\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createTextVNode(\" Voting system initialization \")];\n    }),\n    _: 1 /* STABLE */\n  }), _createCommentVNode(\" 设置垂直间距 \"), _createVNode(_component_van_row, {\n    justify: \"center\"\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createVNode(_component_van_col, {\n        span: \"10\"\n      }, {\n        \"default\": _withCtx(function () {\n          return [_createElementVNode(\"p\", _hoisted_2, [_createVNode(_component_van_icon, {\n            name: \"manager\"\n          }), _createTextVNode(\"主持人地址\")]), _createElementVNode(\"p\", _hoisted_3, [_createVNode(_component_van_tag, {\n            round: \"\",\n            type: \"primary\",\n            size: \"large\"\n          }, {\n            \"default\": _withCtx(function () {\n              return [_createTextVNode(_toDisplayString($setup.host), 1 /* TEXT */)];\n            }),\n\n            _: 1 /* STABLE */\n          })])];\n        }),\n\n        _: 1 /* STABLE */\n      }), _createVNode(_component_van_col, {\n        span: \"6\"\n      }, {\n        \"default\": _withCtx(function () {\n          return [_hoisted_4, _createElementVNode(\"p\", null, [_createVNode(_component_van_tag, {\n            round: \"\",\n            type: \"primary\",\n            size: \"large\"\n          }, {\n            \"default\": _withCtx(function () {\n              return [_createVNode(_component_van_count_down, {\n                time: $setup.toMilliseconds($setup.voteTime),\n                format: \"DD 天 HH 时 mm 分 ss 秒\"\n              }, null, 8 /* PROPS */, [\"time\"])];\n            }),\n            _: 1 /* STABLE */\n          })])];\n        }),\n\n        _: 1 /* STABLE */\n      })];\n    }),\n\n    _: 1 /* STABLE */\n  }), _createVNode(_component_van_divider, {\n    style: {\n      color: '#1989fa',\n      borderColor: 'red',\n      padding: '0px 10px'\n    }\n  }), _createElementVNode(\"div\", null, [_createVNode(_component_van_cell_group, {\n    inset: \"\"\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createVNode(_component_van_field, {\n        modelValue: $setup.initVoteTime,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n          return $setup.initVoteTime = $event;\n        }),\n        required: \"\",\n        label: \"投票时间\",\n        placeholder: \"请输入投票时间\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])];\n    }),\n    _: 1 /* STABLE */\n  })]), _createElementVNode(\"div\", _hoisted_5, [_createVNode(_component_van_button, {\n    round: \"\",\n    block: \"\",\n    onClick: $setup.startVoting,\n    type: \"success\"\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createTextVNode(\"开始投票\")];\n    }),\n    _: 1 /* STABLE */\n  })]), _createVNode(_component_van_divider, {\n    style: {\n      color: '#1989fa',\n      borderColor: 'red',\n      padding: '0px 10px'\n    }\n  }), _createElementVNode(\"div\", null, [_createVNode(_component_van_cell_group, {\n    inset: \"\"\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createVNode(_component_van_field, {\n        modelValue: $setup.voterAddress,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n          return $setup.voterAddress = $event;\n        }),\n        required: \"\",\n        label: \"投票人地址\",\n        placeholder: \"请输入投票人地址\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])];\n    }),\n    _: 1 /* STABLE */\n  })]), _createElementVNode(\"div\", _hoisted_6, [_createVNode(_component_van_button, {\n    block: \"\",\n    onClick: $setup.mandate\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createTextVNode(\"开始分发选票\")];\n    }),\n    _: 1 /* STABLE */\n  })]), _createVNode(_component_van_divider, {\n    style: {\n      color: '#1989fa',\n      borderColor: 'red',\n      padding: '10px 10px'\n    }\n  }), _createElementVNode(\"div\", null, [_createVNode(_component_van_cell_group, {\n    inset: \"\"\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createVNode(_component_van_field, {\n        modelValue: $setup.removeTheAccount,\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = function ($event) {\n          return $setup.removeTheAccount = $event;\n        }),\n        required: \"\",\n        label: \"去除投票人\",\n        placeholder: \"请输入去除投票人地址\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])];\n    }),\n    _: 1 /* STABLE */\n  })]), _createElementVNode(\"div\", _hoisted_7, [_createVNode(_component_van_button, {\n    block: \"\",\n    onClick: $setup.removeAccount\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createTextVNode(\"去除投票人\")];\n    }),\n    _: 1 /* STABLE */\n  })]), _createVNode(_component_van_divider), _createVNode(_component_van_divider, {\n    style: {\n      color: '#1989fa',\n      borderColor: 'red',\n      padding: '10px 10px'\n    }\n  }), _createElementVNode(\"div\", _hoisted_8, [_createVNode(_component_van_button, {\n    block: \"\",\n    onClick: $setup.endVoting\n  }, {\n    \"default\": _withCtx(function () {\n      return [_createTextVNode(\"结束选票\")];\n    }),\n    _: 1 /* STABLE */\n  })])]);\n}","map":{"version":3,"mappings":"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","names":["_createElementVNode","_createElementBlock","_hoisted_1","_createVNode","_component_van_divider","style","color","borderColor","padding","_createCommentVNode","_component_van_row","justify","_component_van_col","span","_hoisted_2","_component_van_icon","name","_hoisted_3","_component_van_tag","round","type","size","$setup","_hoisted_4","_component_van_count_down","time","format","_component_van_cell_group","inset","_component_van_field","required","label","placeholder","_hoisted_5","_component_van_button","block","onClick","_hoisted_6","_hoisted_7","_hoisted_8"],"sourceRoot":"","sources":["/Users/puzhiqiu/工程项目/HackQuest/HackQuest/vue/src/views/MandateView.vue"],"sourcesContent":["\n<template>\n  <div class=\"box1\">\n    <van-divider\n      :style=\"{ color: '#1989fa', borderColor: 'red', padding: '-20px 10px' }\"\n    >\n      Voting system initialization\n    </van-divider>\n\n    <!-- 设置垂直间距 -->\n    <van-row justify=\"center\">\n      <van-col span=\"10\">\n        <p class=\"label\"><van-icon name=\"manager\" />主持人地址</p>\n        <p class=\"address\">\n          <van-tag round type=\"primary\" size=\"large\">{{ host }}</van-tag>\n        </p></van-col\n      >\n\n      <van-col span=\"6\"\n        ><p>剩余投票时间:</p>\n        <p>\n          <van-tag round type=\"primary\" size=\"large\"\n            ><van-count-down\n              :time=\"toMilliseconds(voteTime)\"\n              format=\"DD 天 HH 时 mm 分 ss 秒\"\n          /></van-tag></p\n      ></van-col>\n    </van-row>\n\n    <van-divider\n      :style=\"{ color: '#1989fa', borderColor: 'red', padding: '0px 10px' }\"\n    >\n    </van-divider>\n    <div>\n      <van-cell-group inset>\n        <van-field\n          v-model=\"initVoteTime\"\n          required\n          label=\"投票时间\"\n          placeholder=\"请输入投票时间\"\n        />\n      </van-cell-group>\n    </div>\n\n    <div class=\"btn\">\n      <van-button round block @click=\"startVoting\" type=\"success\"\n        >开始投票</van-button\n      >\n    </div>\n    <van-divider\n      :style=\"{ color: '#1989fa', borderColor: 'red', padding: '0px 10px' }\"\n    >\n    </van-divider>\n\n    <div>\n      <van-cell-group inset>\n        <van-field\n          v-model=\"voterAddress\"\n          required\n          label=\"投票人地址\"\n          placeholder=\"请输入投票人地址\"\n        />\n      </van-cell-group>\n    </div>\n    <div class=\"btn\">\n      <van-button block @click=\"mandate\">开始分发选票</van-button>\n    </div>\n    <van-divider\n      :style=\"{ color: '#1989fa', borderColor: 'red', padding: '10px 10px' }\"\n    >\n    </van-divider>\n    <div>\n      <van-cell-group inset>\n        <van-field\n          v-model=\"removeTheAccount\"\n          required\n          label=\"去除投票人\"\n          placeholder=\"请输入去除投票人地址\"\n        />\n      </van-cell-group>\n    </div>\n    <div class=\"btn\">\n      <van-button block @click=\"removeAccount\">去除投票人</van-button>\n    </div>\n    <van-divider />\n    <van-divider\n      :style=\"{ color: '#1989fa', borderColor: 'red', padding: '10px 10px' }\"\n    >\n    </van-divider>\n    <div class=\"btn\">\n      <van-button block @click=\"endVoting\">结束选票</van-button>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport useWeb3 from \"../hooks/useWeb3\";\nimport { ref, onMounted, createApp } from \"vue\";\nconst { web3, voteContract, getAccount } = useWeb3();\nimport { Field, CellGroup, Notify } from \"vant\";\n\nconst app = createApp();\napp.use(Field);\napp.use(CellGroup);\n\n// 定义主持人信息\nconst host = ref(\"\");\n\nconst account = ref(\"\");\n\n// 获取主持人信息\nconst getHost = async () => {\n  host.value = await voteContract.methods.host().call();\n};\n\n// 选民地址\nconst voterAddress = ref(\"\");\n//去除投票人\nconst removeTheAccount = ref(\"\");\n//投票时间\nconst voteTime = ref(\"0\");\n// 初始化投票时间\nconst initVoteTime = ref(\"0\");\n//结束选票\nconst endVoting = async () => {\n  const account = await getAccount();\n  voteContract.methods\n    .endVoting()\n    .send({ from: account })\n    .on(\"receipt\", () => {\n      Notify({ type: \"success\", message: \"结束投票成功\" });\n    })\n    .on(\"error\", (error) => {\n      Notify({ type: \"danger\", message: \"结束投票失败: \" + error.message });\n    });\n};\n\n// 分发票权\nconst mandate = async () => {\n  const arr = eval(voterAddress.value);\n  const account = await getAccount();\n  voteContract.methods\n    .mandate(arr)\n    .send({ from: account })\n    .on(\"receipt\", () => {\n      Notify({ type: \"success\", message: \"选票分发成功\" });\n    })\n    .on(\"error\", (error) => {\n      Notify({ type: \"danger\", message: \"选票分发失败: \" + error.message });\n    });\n};\n// 开始投票\nconst startVoting = async () => {\n  const account = await getAccount();\n  voteContract.methods\n    .startVoting(initVoteTime.value) // 假设投票选项为 0\n    .send({ from: account })\n    .on(\"receipt\", () => {\n      Notify({ type: \"success\", message: \"投票成功\" });\n    })\n    .on(\"error\", (error) => {\n      Notify({ type: \"danger\", message: \"投票失败: \" + error.message });\n    });\n};\n//去除投票人\nconst removeAccount = async () => {\n  const arr = eval(removeTheAccount.value);\n  const account = await getAccount();\n  voteContract.methods\n    .removeVoter(arr) // 假设投票选项为 0\n    .send({ from: account })\n    .on(\"receipt\", () => {\n      Notify({ type: \"success\", message: \"投票人移除成功\" });\n    })\n    .on(\"error\", (error) => {\n      Notify({ type: \"danger\", message: \"投票人移除失败: \" + error.message });\n    });\n};\n//获取合约剩余时间\nconst getVoteTime = async () => {\n  voteTime.value = await voteContract.methods.leftTime().call();\n};\n\n// 转换秒数为毫秒数\nconst toMilliseconds = (seconds) => {\n  return seconds * 1000;\n};\n\nonMounted(async () => {\n  await getHost();\n  await getVoteTime();\n  setInterval(async () => {\n    await getVoteTime();\n  }, 1000); // 每秒更新一次\n});\n</script>\n\n<style scoped>\n.box1 {\n  padding: 10px;\n  height: 80vh; /* 使用视口高度的80% */\n  overflow-y: scroll; /* 启用垂直滚动条 */\n}\n\n.vote-time {\n  margin: 20px 0;\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}